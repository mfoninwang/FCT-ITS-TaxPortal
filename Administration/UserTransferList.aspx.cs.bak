using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using DevExpress.Web.ASPxGridLookup;
using DevExpress.Web.ASPxEditors;
using DevExpress.Web.ASPxFormLayout;
using DevExpress.Web.ASPxGridView;
using DevExpress.Web.Data;
using FIRSTAAPs.Model;

namespace FIRSTAAPs.Administration
{
    public partial class UserTransferList : BasePage
    {
        TAAPsDBContext _context = new TAAPsDBContext();

        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack && !IsCallback)
            {
                
            }
        }

        protected void ASPxPopupControl1_WindowCallback(object source, DevExpress.Web.ASPxPopupControl.PopupWindowCallbackArgs e)
        {
            string key = e.Parameter;
            Session["TransferUser"] = key;
        }

        protected void ASPxgvUsers_CustomCallback(object sender, DevExpress.Web.ASPxGridView.ASPxGridViewCustomCallbackEventArgs e)
        {
            ASPxgvUsers.DataBind();
        }

        protected void ASPxgvTransfers_InitNewRow(object sender, ASPxDataInitNewRowEventArgs e)
        {
            string name = Session["TransferUser"].ToString();
            string createdby = Session["UserName"].ToString();

            var user = _context.Users.Where(u => u.UserName == name).Single();

            e.NewValues["FromTaxOfficeId"] = user.TaxOfficeId;
            e.NewValues["CreatedBy"] = user.TaxOfficeId;
        }

        protected void ASPxgvTransfers_CustomErrorText(object sender, DevExpress.Web.ASPxGridView.ASPxGridViewCustomErrorTextEventArgs e)
        {
            e.ErrorText = e.Exception.ToString();
        }

        protected void ASPxgvTransfers_RowInserted(object sender, ASPxDataInsertedEventArgs e)
        {
            if (e.Exception == null)
            {
                ((ASPxGridView)sender).JSProperties["cpIsInserted"] = true;
            }
        }

        protected void ASPxgvTransfers_CancelRowEditing(object sender, ASPxStartRowEditingEventArgs e)
        {
            ((ASPxGridView)sender).JSProperties["cpIsCancelled"] = true;
        }      
    }
}